import { CommonUtils } from '../core/utils/CommonUtils.js';
import { globalConfig } from '../core/ConfigManager.js';
import { ImageGenerator } from '../render/ImageGenerator.js';

/**
 * å¸®åŠ©å‘½ä»¤å¤„ç†ç±»
 */
class HelpCommands {
    constructor(dataService = null) {
        this.imageGenerator = new ImageGenerator(dataService);
    }

    /**
     * è·å–å‘½ä»¤è§„åˆ™
     */
    static getRules() {
        return [
            {
                reg: '^#æ°´ç¾¤å¸®åŠ©$',
                fnc: 'showHelp'
            }
        ];
    }

    /**
     * æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
     */
    async showHelp(e) {
        const validation = CommonUtils.validateGroupMessage(e, false);
        if (!validation.valid) {
            return e.reply(validation.message);
        }

        // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨å›¾ç‰‡æ¨¡å¼
        const usePicture = globalConfig.getConfig('display.usePicture');
        if (usePicture) {
            try {
                const isMaster = e.isMaster || false;
                const imagePath = await this.imageGenerator.generateHelpPanelImage(isMaster);
                return e.reply(segment.image(`file:///${imagePath.replace(/\\/g, '/')}`));
            } catch (error) {
                globalConfig.error('ç”Ÿæˆå¸®åŠ©é¢æ¿å›¾ç‰‡å¤±è´¥:', error);
                // å›é€€åˆ°æ–‡æœ¬æ¨¡å¼
            }
        }

        // æ–‡æœ¬æ¨¡å¼
        const isMaster = e.isMaster || false;
        
        let helpText = `ğŸ“Š å‘è¨€ç»Ÿè®¡æ’ä»¶å¸®åŠ©

ã€åŸºç¡€å‘½ä»¤ã€‘
#æ°´ç¾¤æ€»æ¦œ - æŸ¥çœ‹æ€»å‘è¨€æ’è¡Œ
#æ°´ç¾¤æ—¥æ¦œ - æŸ¥çœ‹ä»Šæ—¥æ’è¡Œ
#æ°´ç¾¤å‘¨æ¦œ - æŸ¥çœ‹æœ¬å‘¨æ’è¡Œ
#æ°´ç¾¤æœˆæ¦œ - æŸ¥çœ‹æœ¬æœˆæ’è¡Œ
#æ°´ç¾¤å¹´æ¦œ - æŸ¥çœ‹ä»Šå¹´æ’è¡Œ
#æ°´ç¾¤æŸ¥è¯¢ - æŸ¥è¯¢ä¸ªäººç»Ÿè®¡æ•°æ®ï¼ˆæ”¯æŒ @ æŸ¥è¯¢ä»–äººï¼‰
#æ°´ç¾¤æŸ¥è¯¢ç¾¤åˆ—è¡¨ - æŸ¥çœ‹ç”¨æˆ·æ‰€åœ¨çš„æ‰€æœ‰ç¾¤èŠ
#æ°´ç¾¤ç»Ÿè®¡ - æŸ¥çœ‹å½“å‰ç¾¤èŠçš„ç»Ÿè®¡ä¿¡æ¯
#æ°´ç¾¤æ€»ç»Ÿè®¡ - æŸ¥çœ‹å…¨å±€ç»Ÿè®¡ä¿¡æ¯

ã€æˆå°±ç³»ç»Ÿã€‘
#æ°´ç¾¤æˆå°±åˆ—è¡¨ - æŸ¥çœ‹å½“å‰ç¾¤èŠæ‰€æœ‰å¯è·å–çš„æˆå°±
#æ°´ç¾¤è®¾ç½®æ˜¾ç¤ºæˆå°± <æˆå°±å> - æ‰‹åŠ¨è®¾ç½®ä¸ªäººèµ„æ–™é¡µæ˜¾ç¤ºçš„æˆå°±
#æ°´ç¾¤æˆå°±ç»Ÿè®¡ - æŸ¥çœ‹æ¯ä¸ªæˆå°±çš„è·å–æƒ…å†µ

ã€èƒŒæ™¯è®¾ç½®ã€‘
#æ°´ç¾¤è®¾ç½®èƒŒæ™¯ - ç”ŸæˆèƒŒæ™¯è®¾ç½®é¡µé¢é“¾æ¥
#æ°´ç¾¤èƒŒæ™¯å¸®åŠ© - æŸ¥çœ‹èƒŒæ™¯è®¾ç½®å¸®åŠ©ä¿¡æ¯

ã€ç½‘é¡µåŠŸèƒ½ã€‘
#æ°´ç¾¤ç½‘é¡µ - ç”Ÿæˆä¸ªäººç»Ÿè®¡é¡µé¢é“¾æ¥ï¼ˆTokenè®¿é—®ï¼‰`;

        if (isMaster) {
            helpText += `

ã€ç®¡ç†å‘˜å‘½ä»¤ï¼ˆä»…ä¸»äººï¼‰ã€‘
ã€æ•°æ®ç®¡ç†ã€‘
#æ°´ç¾¤æ¸…é™¤ç»Ÿè®¡ - æ¸…é™¤å½“å‰ç¾¤çš„ç»Ÿè®¡æ•°æ®
#æ°´ç¾¤æ¸…ç†åƒµå°¸ç¾¤ - åˆ—å‡ºæ‰€æœ‰åƒµå°¸ç¾¤
#æ°´ç¾¤ç¡®è®¤æ¸…ç† - ç¡®è®¤æ¸…ç†åˆ—å‡ºçš„åƒµå°¸ç¾¤

ã€ç³»ç»Ÿè®¾ç½®ã€‘
#æ°´ç¾¤è®¾ç½®äººæ•°+<æ•°å­—> - è®¾ç½®æ’è¡Œæ¦œæ˜¾ç¤ºäººæ•°
#æ°´ç¾¤è®¾ç½®å¼€å¯/å…³é—­è½¬å‘ - åˆ‡æ¢è½¬å‘æ¶ˆæ¯æ¨¡å¼
#æ°´ç¾¤è®¾ç½®å¼€å¯/å…³é—­å›¾ç‰‡ - åˆ‡æ¢å›¾ç‰‡æ˜¾ç¤ºæ¨¡å¼
#æ°´ç¾¤è®¾ç½®å¼€å¯/å…³é—­è®°å½• - åˆ‡æ¢æ¶ˆæ¯è®°å½•åŠŸèƒ½
#æ°´ç¾¤è®¾ç½®å¼€å¯/å…³é—­æ—¥å¿— - åˆ‡æ¢è°ƒè¯•æ—¥å¿—è¾“å‡º
#æ°´ç¾¤è®¾ç½®å¼€å¯/å…³é—­é€šçŸ¥ - åˆ‡æ¢æˆå°±è§£é”é€šçŸ¥
#æ°´ç¾¤æ›´æ–° - æ›´æ–°æ’ä»¶åˆ°æœ€æ–°ç‰ˆæœ¬
#æ°´ç¾¤å¼ºåˆ¶æ›´æ–° - å¼ºåˆ¶æ›´æ–°æ’ä»¶ï¼ˆè¦†ç›–æœ¬åœ°ä¿®æ”¹ï¼‰
#åˆ·æ–°æ°´ç¾¤æˆå°± - åˆ·æ–°å½“å‰ç¾¤ç»„çš„æ‰€æœ‰æ˜¾ç¤ºæˆå°±
#åˆ·æ–°å…¨ç¾¤æ°´ç¾¤æˆå°± - åˆ·æ–°æ‰€æœ‰ç¾¤ç»„çš„æ‰€æœ‰æ˜¾ç¤ºæˆå°±`;
        }

        helpText += `

ã€å¸®åŠ©ã€‘
#æ°´ç¾¤å¸®åŠ© - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯`;

        return e.reply(helpText);
    }
}

export { HelpCommands };
export default HelpCommands;

