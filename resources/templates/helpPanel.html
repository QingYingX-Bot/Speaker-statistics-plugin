<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>发言统计 · 帮助面板</title>
  <style>
    /* 统一深色配色，提升对比与可读性 */
    :root {
      --bg: #0c1021;
      --bg2: #0f1326;
      --card: #151a33;
      --card-border: rgba(255,255,255,.08);
      --muted: #aeb6cc;
      --text: #eef2f8;
      --brand: #77a9ff;
      --brand-2: #96c2ff;
      --accent: #a58bff;
      --accent-2: #c9b9ff;
      --shadow: rgba(0,0,0,.45);
      --hover: rgba(255,255,255,.04);
      --badge: rgba(119,169,255,.15);
    }
    * { box-sizing: border-box; }
    body { margin:0; padding:24px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; background: radial-gradient(1000px 600px at 10% -10%, #0a1332 0%, transparent 60%), linear-gradient(120deg, var(--bg) 0%, var(--bg2) 100%); color: var(--text); }
    .container { max-width: 1400px; margin: 0 auto; }
    .header { display:flex; align-items:center; justify-content: space-between; margin-bottom: 16px; }
    .title { font-size: 48px; font-weight: 700; letter-spacing: .5px; }
    .meta { color: var(--muted); font-size: 18px; }
    .panel { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 12px 36px var(--shadow); border: 1px solid var(--card-border); }
    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    .section { background: rgba(255,255,255,.02); border: 1px solid var(--card-border); border-radius: 10px; padding: 12px; }
    .section-title { display:flex; align-items:center; font-weight: 700; color: var(--brand-2); margin-bottom: 20px; letter-spacing:.3px; font-size:36px; }
    .command-grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 20px; }
    .command-grid.single { grid-template-columns: 1fr; }
    .command-grid.triple { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .command-category { background: rgba(255,255,255,.02); border-radius: 8px; padding: 8px; border: 1px solid var(--card-border); }
    .category-title { color: var(--brand-2); font-weight: 700; margin-bottom: 12px; display:flex; align-items:center; font-size:28px; }
    .command-list { list-style: none; margin: 0; padding: 0; display:grid; gap: 12px; }
    .command-item { display:flex; align-items: baseline; gap: 20px; padding: 16px 18px; border-radius: 14px; background: rgba(255,255,255,.02); border:1px solid var(--card-border); transition: background .15s ease, border-color .15s ease, transform .12s ease; }
    .command-item:hover { background: var(--hover); border-color: rgba(255,255,255,.12); transform: translateY(-1px); }
    .command { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color: var(--brand); font-weight: 800; padding: 6px 14px; border-radius: 8px; background: var(--badge); font-size: 28px; }
    .command-desc { color: var(--muted); font-size: 28px; }

    /* 自适应布局，宽度变化时自动调整列数，减少空白 */
    @media (max-width: 1280px) {
      .container { max-width: 1180px; }
      .command-grid { grid-template-columns: 1fr 1fr; gap: 16px; }
      .command-grid.triple { grid-template-columns: 1fr 1fr; }
      .section-title { font-size: 30px; margin-bottom: 16px; }
      .category-title { font-size: 24px; margin-bottom: 10px; }
      .command, .command-desc { font-size: 22px; }
      .command-item { padding: 14px 16px; gap: 16px; }
    }
    @media (max-width: 900px) {
      .container { max-width: 820px; padding: 0 8px; }
      .command-grid, .command-grid.triple { grid-template-columns: 1fr; gap: 12px; }
      .section-title { font-size: 24px; }
      .category-title { font-size: 18px; }
      .command, .command-desc { font-size: 18px; }
    }
    .admin-section { background: linear-gradient(180deg, rgba(165,139,255,.10), rgba(165,139,255,.06)); border: 1px solid rgba(165,139,255,.30); border-radius: 10px; padding: 12px; }
    .footer { color: var(--muted); margin-top: 12px; font-size: 18px; text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Speaker-statistics-plugin · 帮助</div>
      <div class="meta">v{{VERSION}} · 生成时间 {{GENERATE_TIME}}</div>
    </div>
    <div class="panel">
      <div id="help-root" class="grid"></div>
      <div class="footer">By QingYingX</div>
    </div>
  </div>

  <script type="module">
    const IS_MASTER = {{IS_MASTER}}; // true/false

    // 命令去重：同一分类内相同 cmd/desc 只保留一次
    function uniqueCommands(list) {
      const seen = new Set();
      const out = [];
      for (const it of (list || [])) {
        const key = `${it.cmd || ''}|${it.desc || ''}`;
        if (!seen.has(key)) {
          seen.add(key);
          out.push(it);
        }
      }
      return out;
    }

    function el(tag, attrs = {}, children = []) {
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k, v]) => {
        if (k === 'class') node.className = v; else node.setAttribute(k, v);
      });
      (Array.isArray(children) ? children : [children]).forEach(c => {
        if (typeof c === 'string') node.appendChild(document.createTextNode(c));
        else if (c) node.appendChild(c);
      });
      return node;
    }

    function section(title, _icon, categories) {
      const items = categories.map(cat => {
        const dedup = uniqueCommands(cat.items || []);
        const ul = el('ul', { class: 'command-list' }, dedup.map(it => el('li', { class: 'command-item' }, [
          el('span', { class: 'command' }, it.cmd),
          el('span', { class: 'command-desc' }, it.desc)
        ])));

        return el('div', { class: 'command-category' }, [
          el('div', { class: 'category-title' }, [ cat.title ]),
          ul
        ]);
      });

      const sectionNode = el('div', { class: 'section' }, [
        el('div', { class: 'section-title' }, [ title ]),
        el('div', { class: 'command-grid' }, items)
      ]);
      if (categories.length === 1) {
        sectionNode.querySelector('.command-grid').classList.add('single');
      }
      return sectionNode;
    }

    function buildData(isMaster) {
      const basic = section('基础命令', null, [
        { items:[
          { cmd:'#水群榜', desc:'查看本月排行榜' },
          { cmd:'#水群总榜', desc:'查看总发言排行' },
          { cmd:'#水群日榜', desc:'查看今日排行' },
          { cmd:'#水群周榜', desc:'查看本周排行' },
          { cmd:'#水群月榜', desc:'查看本月排行' },
          { cmd:'#水群年榜', desc:'查看今年排行' }
        ]},
        { items:[
          { cmd:'#水群查询', desc:'查询个人统计数据' },
          { cmd:'#水群查询群列表', desc:'查看用户所在群聊' },
          { cmd:'#水群统计', desc:'查看群聊统计信息' },
          { cmd:'#水群总统计', desc:'查看全局统计信息' },
          { cmd:'#总水群统计', desc:'查看全局统计信息' }
        ]}
      ]);

      const achieve = section('成就系统', null, [
        { items:[
          { cmd:'#水群成就', desc:'查看个人成就概览' },
          { cmd:'#水群成就列表', desc:'查看已解锁徽章' },
          { cmd:'#水群设置显示成就 [成就名]', desc:'设置排行榜显示的成就' }
        ]}
      ]);

      const background = section('背景设置', null, [
        { items:[
          { cmd:'#水群设置背景', desc:'设置个人统计背景' },
          { cmd:'#水群删除背景', desc:'删除个人统计背景' },
          { cmd:'#水群背景帮助', desc:'查看背景设置帮助' }
        ]}
      ]);

      const root = document.getElementById('help-root');
      [basic, achieve, background].forEach(n => root.appendChild(n));

      if (isMaster) {
        const adminWrap = el('div', { class: 'admin-section section' }, [ el('div', { class: 'section-title' }, [ '管理员命令（仅主人）' ]) ]);
        const adminGrid = el('div', { class: 'command-grid' });
        adminWrap.appendChild(adminGrid);

        const dataMgmt = el('div', { class: 'command-category' }, [
          el('div', { class: 'category-title' }, [ '数据管理' ]),
          el('ul', { class: 'command-list' }, uniqueCommands([
            { cmd:'#水群清除统计', desc:'清除当前群统计数据' }
          ]).map(it => el('li', { class: 'command-item' }, [ el('span', { class: 'command' }, it.cmd), el('span', { class: 'command-desc' }, it.desc) ])))
        ]);

        const systemCfg = el('div', { class: 'command-category', style: 'grid-column: span 2;' }, [
          el('div', { class: 'category-title' }, [ '系统设置' ]),
          el('ul', { class: 'command-list' }, uniqueCommands([
            { cmd:'#水群设置人数+数字', desc:'设置显示人数' },
            { cmd:'#水群设置开启/关闭转发', desc:'是否使用转发消息' },
            { cmd:'#水群设置开启/关闭图片', desc:'是否使用图片模式' },
            { cmd:'#水群设置开启/关闭记录', desc:'是否记录消息' },
            { cmd:'#水群设置开启/关闭日志', desc:'是否开启调试日志' }
          ]).map(it => el('li', { class: 'command-item' }, [ el('span', { class: 'command' }, it.cmd), el('span', { class: 'command-desc' }, it.desc) ])))
        ]);

        [dataMgmt, systemCfg].forEach(n => adminGrid.appendChild(n));
        root.appendChild(adminWrap);
      }
    }

    buildData(IS_MASTER === true);
  </script>
</body>
</html>


