<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>发言统计 · 帮助面板</title>
  <style>
    /* 统一深色配色，提升对比与可读性 */
    :root {
      --bg: #0c1021;
      --bg2: #0f1326;
      --card: #151a33;
      --card-border: rgba(255,255,255,.08);
      --muted: #aeb6cc;
      --text: #eef2f8;
      --brand: #77a9ff;
      --brand-2: #96c2ff;
      --accent: #a58bff;
      --accent-2: #c9b9ff;
      --shadow: rgba(0,0,0,.45);
      --hover: rgba(255,255,255,.04);
      --badge: rgba(119,169,255,.15);
    }
    * { box-sizing: border-box; }
    body { margin:0; padding:24px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; background: radial-gradient(1000px 600px at 10% -10%, #0a1332 0%, transparent 60%), linear-gradient(120deg, var(--bg) 0%, var(--bg2) 100%); color: var(--text); }
    .container { max-width: 1400px; margin: 0 auto; }
    .header { display:flex; align-items:center; justify-content: space-between; margin-bottom: 24px; }
    .title { font-size: 48px; font-weight: 700; letter-spacing: .5px; }
    .meta { color: var(--muted); font-size: 18px; }
    .panel { background: var(--card); border-radius: 12px; padding: 24px; box-shadow: 0 12px 36px var(--shadow); border: 1px solid var(--card-border); }
    .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
    .section { background: rgba(255,255,255,.02); border: 1px solid var(--card-border); border-radius: 10px; padding: 20px; margin-bottom: 16px; }
    .section-title { display:flex; align-items:center; font-weight: 700; color: var(--brand-2); margin-bottom: 24px; letter-spacing:.3px; font-size:36px; }
    .command-grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 24px; }
    .command-grid.single { grid-template-columns: 1fr; }
    .command-grid.triple { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .command-category { background: rgba(255,255,255,.02); border-radius: 8px; padding: 16px; border: 1px solid var(--card-border); }
    .category-title { color: var(--brand-2); font-weight: 700; margin-bottom: 16px; display:flex; align-items:center; font-size:28px; padding-bottom: 8px; border-bottom: 1px solid var(--card-border); }
    .command-list { list-style: none; margin: 0; padding: 0; display:grid; gap: 10px; }
    .command-item { display:flex; align-items: baseline; gap: 20px; padding: 14px 16px; border-radius: 10px; background: rgba(255,255,255,.02); border:1px solid var(--card-border); transition: all .2s ease; }
    .command-item:hover { background: var(--hover); border-color: rgba(255,255,255,.15); transform: translateX(2px); }
    .command { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color: var(--brand); font-weight: 800; padding: 6px 14px; border-radius: 8px; background: var(--badge); font-size: 26px; white-space: nowrap; flex-shrink: 0; }
    .command-desc { color: var(--muted); font-size: 26px; line-height: 1.5; }
    .admin-section { background: linear-gradient(180deg, rgba(165,139,255,.10), rgba(165,139,255,.06)); border: 1px solid rgba(165,139,255,.30); border-radius: 10px; padding: 20px; }
    .footer { color: var(--muted); margin-top: 24px; font-size: 18px; text-align: right; padding-top: 16px; border-top: 1px solid var(--card-border); }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Speaker-statistics-plugin · 帮助</div>
      <div class="meta">v{{VERSION}} · 生成时间 {{GENERATE_TIME}}</div>
    </div>
    <div class="panel">
      <div id="help-root" class="grid"></div>
      <div class="footer">By QingYingX</div>
    </div>
  </div>

  <script type="module">
    // 从模板变量获取是否为管理员
    const IS_MASTER = String('{{IS_MASTER}}') === 'true';

    // 命令去重：同一分类内相同 cmd/desc 只保留一次
    function uniqueCommands(list) {
      const seen = new Set();
      const out = [];
      for (const it of (list || [])) {
        const key = `${it.cmd || ''}|${it.desc || ''}`;
        if (!seen.has(key)) {
          seen.add(key);
          out.push(it);
        }
      }
      return out;
    }

    function el(tag, attrs = {}, children = []) {
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k, v]) => {
        if (k === 'class') node.className = v; else node.setAttribute(k, v);
      });
      (Array.isArray(children) ? children : [children]).forEach(c => {
        if (typeof c === 'string') node.appendChild(document.createTextNode(c));
        else if (c) node.appendChild(c);
      });
      return node;
    }

    function section(title, _icon, categories) {
      const items = categories.map(cat => {
        const dedup = uniqueCommands(cat.items || []);
        const ul = el('ul', { class: 'command-list' }, dedup.map(it => el('li', { class: 'command-item' }, [
          el('span', { class: 'command' }, it.cmd),
          el('span', { class: 'command-desc' }, it.desc)
        ])));

        return el('div', { class: 'command-category' }, [
          el('div', { class: 'category-title' }, [ cat.title ]),
          ul
        ]);
      });

      const sectionNode = el('div', { class: 'section' }, [
        el('div', { class: 'section-title' }, [ title ]),
        el('div', { class: 'command-grid' }, items)
      ]);
      if (categories.length === 1) {
        sectionNode.querySelector('.command-grid').classList.add('single');
      }
      return sectionNode;
    }

    function buildData(isMaster) {
      const basic = section('基础命令', null, [
        { title: '排行榜', items:[
          { cmd:'#水群总榜', desc:'查看总发言排行' },
          { cmd:'#水群日榜', desc:'查看今日排行' },
          { cmd:'#水群周榜', desc:'查看本周排行' },
          { cmd:'#水群月榜', desc:'查看本月排行' },
          { cmd:'#水群年榜', desc:'查看今年排行' },
          { cmd:'#水群榜', desc:'查看本月排行榜' }
        ]},
        { title: '查询统计', items:[
          { cmd:'#水群查询', desc:'查询个人统计数据（支持 @ 查询他人）' },
          { cmd:'#水群查询群列表', desc:'查看用户所在的所有群聊' },
          { cmd:'#水群统计', desc:'查看当前群聊的统计信息' },
          { cmd:'#水群总统计', desc:'查看全局统计信息' }
        ]}
      ]);

      const wordcloud = section('词云功能', null, [
        { title: '群聊词云', items:[
          { cmd:'#水群词云', desc:'生成当天群聊词云图' },
          { cmd:'#水群词云 三天', desc:'生成近三天群聊词云图' },
          { cmd:'#水群词云 七天', desc:'生成近七天群聊词云图' }
        ]},
        { title: '个人词云', items:[
          { cmd:'#我的水群词云', desc:'生成当天个人词云图' },
          { cmd:'#我的水群词云 三天', desc:'生成近三天个人词云图' },
          { cmd:'#我的水群词云 七天', desc:'生成近七天个人词云图' }
        ]}
      ]);

      const achieve = section('成就系统', null, [
        { items:[
          { cmd:'#水群成就列表', desc:'查看当前群聊所有可获取的成就' },
          { cmd:'#水群设置显示成就 [成就名]', desc:'手动设置个人资料页显示的成就' },
          { cmd:'#水群成就统计', desc:'查看每个成就的获取情况' }
        ]}
      ]);

      const background = section('背景设置', null, [
        { items:[
          { cmd:'#水群设置背景', desc:'生成背景设置页面链接' },
          { cmd:'#水群背景帮助', desc:'查看背景设置帮助信息' }
        ]}
      ]);

      const web = section('网页功能', null, [
        { items:[
          { cmd:'#水群网页', desc:'生成个人统计页面链接（Token访问）' }
        ]}
      ]);

      const root = document.getElementById('help-root');
      [basic, wordcloud, achieve, background, web].forEach(n => root.appendChild(n));

      if (isMaster) {
        const adminWrap = el('div', { class: 'admin-section section' }, [ el('div', { class: 'section-title' }, [ '管理员命令（仅主人）' ]) ]);
        const adminGrid = el('div', { class: 'command-grid' });
        adminWrap.appendChild(adminGrid);

        const dataMgmt = el('div', { class: 'command-category' }, [
          el('div', { class: 'category-title' }, [ '数据管理' ]),
          el('ul', { class: 'command-list' }, uniqueCommands([
            { cmd:'#水群清除统计', desc:'清除当前群统计数据' },
            { cmd:'#水群清理僵尸群', desc:'列出所有僵尸群' },
            { cmd:'#水群确认清理', desc:'确认清理列出的僵尸群' }
          ]).map(it => el('li', { class: 'command-item' }, [ el('span', { class: 'command' }, it.cmd), el('span', { class: 'command-desc' }, it.desc) ])))
        ]);

        const systemCfg = el('div', { class: 'command-category' }, [
          el('div', { class: 'category-title' }, [ '系统设置' ]),
          el('ul', { class: 'command-list' }, uniqueCommands([
            { cmd:'#水群设置人数+<数字>', desc:'设置排行榜显示人数' },
            { cmd:'#水群设置开启/关闭转发', desc:'切换转发消息模式' },
            { cmd:'#水群设置开启/关闭图片', desc:'切换图片显示模式' },
            { cmd:'#水群设置开启/关闭记录', desc:'切换消息记录功能' },
            { cmd:'#水群设置开启/关闭日志', desc:'切换调试日志输出' },
            { cmd:'#水群设置开启/关闭通知', desc:'切换成就解锁通知' },
            { cmd:'#水群更新', desc:'更新插件到最新版本' },
            { cmd:'#水群强制更新', desc:'强制更新插件（覆盖本地修改）' },
            { cmd:'#刷新水群成就', desc:'刷新当前群组的所有显示成就' },
            { cmd:'#刷新全群水群成就', desc:'刷新所有群组的所有显示成就' }
          ]).map(it => el('li', { class: 'command-item' }, [ el('span', { class: 'command' }, it.cmd), el('span', { class: 'command-desc' }, it.desc) ])))
        ]);

        [dataMgmt, systemCfg].forEach(n => adminGrid.appendChild(n));
        root.appendChild(adminWrap);
      }
    }

    buildData(IS_MASTER === true);
  </script>
</body>
</html>


